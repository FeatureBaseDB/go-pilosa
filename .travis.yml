language: go
go:
  - "1.9"
  - "1.10"
  - master
env:
  matrix:
    - GOARCH=386 PILOSA_VERSION=master
    - GOARCH=386 PILOSA_VERSION=v1.0
    - GOARCH=amd64 PILOSA_VERSION=master
    - GOARCH=amd64 PILOSA_VERSION=v1.0
before_install:
  - go get github.com/mattn/goveralls
  - go get -u github.com/golang/dep/cmd/dep
script:
  - make test-all-race TESTFLAGS=-v
  - make start-pilosa
  - sleep 2
  - PILOSA_BIND=https://:20101 $HOME/gopath/bin/goveralls -service=travis-ci -ignore "gopilosa_pbuf/public.pb.go" -flags="-tags='fullcoverage'"
  - make stop-pilosa
